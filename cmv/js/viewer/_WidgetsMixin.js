/*  ConfigurableMapViewerCMV
 *  version 2.0.0-beta.1
 *  Project: http://cmv.io/
 */

define(["dojo/_base/declare","dojo/_base/array","dojo/_base/lang","put-selector","dijit/Menu","dijit/layout/ContentPane","gis/dijit/FloatingTitlePane","gis/dijit/FloatingWidgetDialog"],function(a,b,c,d,e,f,g,h){return a(null,{legendLayerInfos:[],editorLayerInfos:[],identifyLayerInfos:[],layerControlLayerInfos:[],widgets:{},widgetTypes:["titlePane","contentPane","floating","domNode","invisible","map","layer","layout","loading"],createWidgets:function(a){function d(a){return e=b.filter(f,function(b){return b.placeAt&&b.placeAt===a})}var e,f=[];a=a||this.widgetTypes;for(var g in this.config.widgets)if(this.config.widgets.hasOwnProperty(g)){var h=c.clone(this.config.widgets[g]);h.widgetKey=h.widgetKey||h.id||g,h.include&&!this.widgets[h.widgetKey]&&b.indexOf(a,h.type)>=0&&(h.position="undefined"!=typeof h.position?h.position:1e4,"titlePane"!==h.type&&"contentPane"!==h.type||h.placeAt||(h.placeAt="left"),f.push(h),this.widgets[g]=!0)}for(var i in this.panes)this.panes.hasOwnProperty(i)&&"outer"!==i&&"center"!==i&&(e=d(i),e.sort(function(a,b){return a.position-b.position}),e.length>0&&0!==e[0].position&&(e[0].position=0),b.forEach(e,function(a,b){this.widgetLoader(a,b)},this));e=b.filter(f,function(a){return!a.placeAt}),e.sort(function(a,b){return a.position-b.position}),b.forEach(e,function(a,b){this.widgetLoader(a,b)},this)},widgetLoader:function(a,d){var e,f,g=this.widgetTypes;return g=g.concat(this.config.widgetTypes||[]),b.indexOf(g,a.type)<0?void this.handleError({source:"Controller",error:'Widget type "'+a.type+'" ('+a.title+") at position "+d+" is not supported."}):(d&&(a.position=d),"titlePane"!==a.type&&"contentPane"!==a.type&&"floating"!==a.type||(e=a.widgetKey+"_parent","titlePane"===a.type?f=this._createTitlePaneWidget(e,a):"contentPane"===a.type?f=this._createContentPaneWidget(e,a):"floating"===a.type&&(f=this._createFloatingWidget(e,a)),a.parentWidget=f,this._showWidgetLoader(f)),void("string"==typeof a.options?require([a.options,a.path],c.hitch(this,"createWidget",a)):require([a.path],c.hitch(this,"createWidget",a,a.options))))},createWidget:function(a,b,c){var e=a.widgetKey;if(e){b=this._setWidgetOptions(a,b);var f=b.parentWidget,g=this.widgets;"titlePane"===a.type||"contentPane"===a.type||"floating"===a.type?g[e]=new c(b,d("div")).placeAt(f.containerNode):"domNode"===a.type?g[e]=new c(b,a.srcNodeRef):g[e]=new c(b),g[e]&&g[e].startup&&!g[e]._started&&g[e].startup(),this._hideWidgetLoader(f)}},_setWidgetOptions:function(a,b){return a.id&&(b.id=a.id+"_widget"),b.parentWidget=a.parentWidget,b.map&&(b.map=this.map),b.mapRightClickMenu&&(this.mapRightClickMenu||(this.mapRightClickMenu=new e({targetNodeIds:[this.map.root],selector:".esriMapLayers"}),this.mapRightClickMenu.startup()),b.mapRightClickMenu=this.mapRightClickMenu),b.mapClickMode&&(b.mapClickMode=this.mapClickMode.current),b.legendLayerInfos&&(b.layerInfos=this.legendLayerInfos),b.layerControlLayerInfos&&(b.layerInfos=this.layerControlLayerInfos),b.editorLayerInfos&&(b.layerInfos=this.editorLayerInfos),b.identifyLayerInfos&&(b.layerInfos=this.identifyLayerInfos),b},_showWidgetLoader:function(a){a&&a.containerNode&&(a.loadingNode=d(a.containerNode,"div.widgetLoader i.fa.fa-spinner.fa-pulse.fa-fw").parentNode)},_hideWidgetLoader:function(a){a&&a.loadingNode&&require(["dojo/domReady!"],function(){d(a.loadingNode,"!")})},_createTitlePaneWidget:function(a,b){var d,e=c.mixin({title:b.title||"Widget",open:b.open||!1,canFloat:b.canFloat||!1,resizable:b.resizable||!1},b.paneOptions||{});a&&(e.id=a);var f=b.placeAt;return"string"==typeof f&&(f=this.panes[f]),f||(f=this.panes.left),f&&(e.sidebar=f,d=new g(e).placeAt(f,b.position),d.startup()),d},_createFloatingWidget:function(a,b){var d=c.mixin({title:b.title},b.paneOptions||{});a&&(d.id=a);var e=new h(d);return e.startup(),e},_createContentPaneWidget:function(a,b){var d,e=c.mixin({title:b.title,region:b.region||"center"},b.paneOptions||{});b.className&&(e.className=b.className),a&&(e.id=a);var g=b.placeAt;return g?"string"==typeof g&&(g=this.panes[g]):g=this.panes.left,g&&(d=new f(e).placeAt(g),d.startup()),d}})});
//# sourceMappingURL=_WidgetsMixin.js.map